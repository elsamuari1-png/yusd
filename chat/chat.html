<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>ุงูุฏุฑุฏุดุฉ</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>๐ฌ</text></svg>">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script type="module" src="chat.js"></script>
</head>
<body class="dark-chat">

  <div class="app-container">

    <div id="listsView" class="view active">
      <header class="app-header">
        <h1>ุงูุฏุฑุฏุดุฉ</h1>
        <div class="header-actions">
           <button id="createGroupBtn" class="header-icon-btn" title="ุฅูุดุงุก ูุฌููุนุฉ ุฌุฏูุฏุฉ"><i class="fas fa-users"></i></button>
           <button id="globalBtn" class="header-icon-btn" title="ุงูุฏุฑุฏุดุฉ ุงูุนุงูุฉ"><i class="fas fa-globe"></i></button>
        </div>
      </header>
      <nav class="app-tabs">
        <button class="tab-btn active" data-view="recentChatsView">ุงููุญุงุฏุซุงุช</button>
        <button class="tab-btn" data-view="groupsSearchView">ุงููุฌููุนุงุช</button>
        <button class="tab-btn" data-view="userSearchView">ูุณุชุฎุฏููู</button>
      </nav>
      <main class="lists-content">
        <div id="recentChatsView" class="list-container active">
          <ul id="recentChatsList"></ul>
        </div>
        <div id="groupsSearchView" class="list-container">
          <div class="search-bar">
            <input type="text" id="groupSearchInput" class="dialog-input" placeholder="ุงุจุญุซ ุจุงูุงุณู ุฃู ุงููุนุฑู...">
          </div>
          <ul id="groupsList"></ul>
        </div>
        <div id="userSearchView" class="list-container">
          <div class="search-bar">
            <input type="text" id="searchInput" class="dialog-input" placeholder="ุงูุชุจ ุงุณู ุงููุณุชุฎุฏู...">
          </div>
          <ul id="usersList"></ul>
        </div>
      </main>
    </div>

    <div id="chatView" class="view">
        <header class="chatHeader">
            <button id="backToListsBtn" class="header-icon-btn back-btn"><i class="fas fa-arrow-right"></i></button>
            <img id="chatHeaderAvatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%238b949e'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E" alt="Chat Avatar" class="chat-header-avatar">
            <div class="chat-info">
              <span id="chatHeader">ุงุฎุชุฑ ุดุฎุต ููุฏุฑุฏุดุฉ</span>
              <span id="typingIndicator" class="typing-indicator" style="display: none;">ููุชุจ ุงูุขู...</span>
            </div>
        </header>
        <div id="pinnedMessageBar" class="pinned-message-bar" style="display: none;">
            <i class="fas fa-thumbtack pin-icon"></i>
            <p id="pinnedMessageText"></p>
            <button id="unpinMessageBtn" class="unpin-btn">&times;</button>
        </div>
        <div id="messages" class="messages">
            <div id="messageLoader" class="message-loader" style="display: none;"><div class="spinner"></div></div>
        </div>
        <div id="replyPreview" class="reply-preview-bar" style="display: none;">
            <div class="reply-preview-content">
                <strong id="replyPreviewSender"></strong>
                <p id="replyPreviewText"></p>
            </div>
            <button id="cancelReplyBtn" class="cancel-reply-btn">&times;</button>
        </div>
        <div id="mentionSuggestions" class="mention-suggestions"></div>
        <footer class="input-bar">
            <button id="createPollBtn" class="header-icon-btn" title="ุฅูุดุงุก ุงุณุชุทูุงุน" style="display: none;"><i class="fas fa-poll"></i></button>
            <textarea id="messageInput" placeholder="ุงูุชุจ ุฑุณุงูุชู..." rows="1"></textarea>
            <button id="sendMessageBtn">ุฅุฑุณุงู</button>
        </footer>
    </div>
  </div>

  <div id="profileSheet" class="profile-sheet">
    <div class="sheet-handle"></div>
    <button class="dialog-close-btn">&times;</button>
    <div class="profile-sheet-header">
    </div>
    <div class="profile-content">
        <img id="profilePhoto" src="" class="profile-photo" alt="ุตูุฑุฉ ุงูููู ุงูุดุฎุตู">
        <div class="sheet-title-wrapper">
            <h3 id="profileName"></h3>
            <i id="copyProfileNameBtn" class="fas fa-copy copy-icon" title="ูุณุฎ ุงูุงุณู"></i>
        </div>
        <p id="profileBio" class="profile-bio-text"></p>
        <div class="sheet-button-group">
            <button id="startChatFromProfileBtn" class="sheet-btn"><i class="fas fa-comment-dots"></i> ุจุฏุก ุงูุฏุฑุฏุดุฉ</button>
            <button id="reportUserSheetBtn" class="sheet-btn sheet-btn-danger"><i class="fas fa-flag"></i> ุฅุจูุงุบ</button>
            <button id="cancelProfileSheetBtn" class="sheet-btn cancel-btn"><i class="fas fa-times"></i> ุฅูุบุงุก</button>
        </div>
    </div>
  </div>


  <div id="groupSettingsSheet" class="profile-sheet">
    <div class="sheet-handle"></div>
    <button class="dialog-close-btn">&times;</button>
    <div class="sheet-content">
        <div class="sheet-header">
            <img id="sheetGroupPhoto" src="" class="profile-photo-dialog" alt="ุตูุฑุฉ ุงููุฌููุนุฉ">
            <div class="sheet-title-wrapper">
                <span id="sheetGroupName"></span>
                <i id="copyGroupNameBtn" class="fas fa-copy copy-icon" title="ูุณุฎ ุงูุงุณู"></i>
            </div>
            <p>
                ุงููุนุฑู: <code id="sheetGroupId"></code>
                <i id="copyGroupIdBtn" class="fas fa-copy copy-icon" title="ูุณุฎ ุงููุนุฑู"></i>
            </p>
        </div>
        <div id="sheetAdminControls" class="sheet-section">
            <h4>ุฃุฏูุงุช ุงูุฅุฏุงุฑุฉ</h4>
            <div class="settings-toggle-row">
                <span>ุงูุณูุงุญ ุจุฏุฑุฏุดุฉ ุงูุฃุนุถุงุก (ูููุฌููุนุงุช ููุท)</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="chatEnabledToggle">
                    <span class="slider round"></span>
                </label>
            </div>
            <div id="groupInfoEditContainer" style="display: none; width: 100%; flex-direction: column; gap: 10px;">
                <input type="text" id="groupNameEditInput" class="dialog-input" placeholder="ุชุนุฏูู ุงุณู ุงููุฌููุนุฉ">
                <input type="text" id="groupImageEditInput" class="dialog-input" placeholder="ุชุนุฏูู ุฑุงุจุท ุงูุตูุฑุฉ">
                <button id="saveGroupChangesBtn" class="sidebar-btn">ุญูุธ ุงูุชุบููุฑุงุช</button>
            </div>
            <hr id="ownerDivider" class="sidebar-divider" style="display: none;">
            <button id="resetJoinIdBtn" class="sidebar-btn" style="display: none;">ุฅุนุงุฏุฉ ุชุนููู ููุนุฑูู ุงููุฌููุนุฉ</button>
            <button id="deleteGroupBtn" class="sidebar-btn delete-btn" style="display: none;">ุญุฐู ุงููุฌููุนุฉ</button>
        </div>
        <div class="sheet-section">
            <h4>ุงูุฃุนุถุงุก (<span id="sheetMemberCount"></span>)</h4>
            <div id="sheetAdminsList"></div>
            <div id="sheetModeratorsList"></div>
            <div id="sheetMembersList"></div>
        </div>
        <div id="sheetBannedList" class="sheet-section" style="display: none;"></div>
    </div>
  </div>

  <div id="chatDialog" class="dialog-box">
    <div class="dialog-content">
      <div class="dialog-header">
        <h4 id="dialogTitle">ุฑุณุงูุฉ</h4>
        <button class="dialog-close-btn">&times;</button>
      </div>
      <div class="dialog-body">
        <p id="dialogMessage"></p>
      </div>
      <div class="dialog-footer">
        <button class="confirm-btn" onclick="document.getElementById('chatDialog').classList.remove('active')">ุญุณูุงู</button>
      </div>
    </div>
  </div>

  <div id="userProfileDialog" class="dialog-box">
    <div class="dialog-content">
      <button class="dialog-close-btn">&times;</button>
      <img id="dialogProfilePhoto" src="" class="profile-photo-dialog" alt="ุตูุฑุฉ ุงูููู ุงูุดุฎุตู ูููุณุชุฎุฏู">
      <div class="profile-name-wrapper">
        <h3 id="dialogProfileName"></h3>
        <img id="dialogVerificationBadge" src="" class="verification-badge-dialog" style="display: none;" alt="ุดุงุฑุฉ ุงูุชุญูู">
      </div>
      <p id="dialogProfileBio"></p>
      <button id="startChatBtn" class="confirm-btn">ุจุฏุก ุงูุฏุฑุฏุดุฉ</button>
    </div>
  </div>

  <div id="reportDialog" class="dialog-box">
    <div class="dialog-content">
      <button class="dialog-close-btn">&times;</button>
      <h4>ุฅุจูุงุบ ุนู ูุณุชุฎุฏู</h4>
      <p>ูุฑุฌู ูุชุงุจุฉ ุณุจุจ ุงูุฅุจูุงุบ ุจูุถูุญ.</p>
      <textarea id="reportDescriptionInput" class="dialog-textarea" placeholder="ุงูุชุจ ูุตู ุงูุฅุจูุงุบ..."></textarea>
      <div class="dialog-footer">
        <button class="cancel-btn">ุฅูุบุงุก</button>
        <button id="submitReportBtn" class="confirm-btn">ุฅุฑุณุงู ุงูุฅุจูุงุบ</button>
      </div>
    </div>
  </div>

  <div id="createGroupDialog" class="dialog-box">
    <div class="dialog-content">
      <button class="dialog-close-btn">&times;</button>
      <h4>ุฅูุดุงุก ูุฌููุนุฉ ุฃู ููุงุฉ</h4>
      <input type="text" id="groupNameInput" class="dialog-input" placeholder="ุงูุชุจ ุงุณู ุงููุฌููุนุฉ/ุงูููุงุฉ">
      <select id="groupCategorySelect" class="dialog-input">
          <option value="" disabled selected>ุงุฎุชุฑ ุงููุฆุฉ</option>
          <option value="programming">ุงูุจุฑูุฌุฉ</option>
          <option value="content-creation">ุฅูุดุงุก ูุญุชูู</option>
          <option value="language-learning">ุชุนููู ูุบุงุช</option>
      </select>
      <div class="radio-group" style="display: flex; gap: 20px; justify-content: center; margin-bottom: 10px;">
          <label><input type="radio" name="groupType" value="group" checked> ูุฌููุนุฉ</label>
          <label><input type="radio" name="groupType" value="channel"> ููุงุฉ</label>
      </div>
      <input type="text" id="groupImageInput" class="dialog-input" placeholder="ุฑุงุจุท ุตูุฑุฉ ุงููุฌููุนุฉ/ุงูููุงุฉ">
      <div class="dialog-footer">
        <button class="cancel-btn">ุฅูุบุงุก</button>
        <button id="submitCreateGroupBtn" class="confirm-btn">ุฅูุดุงุก</button>
      </div>
    </div>
  </div>

  <div id="permissionsManagementDialog" class="dialog-box">
      <div class="dialog-content">
          <button class="dialog-close-btn">&times;</button>
          <h4 id="permissionsDialogTitle">ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช</h4>
          <div class="dialog-body" style="text-align: right; width: 100%; gap: 12px;">
              <p style="text-align: center; color: var(--text);">ุงููุณุชุฎุฏู: <strong id="permissionsMemberName"></strong></p>
              <div class="settings-toggle-row">
                  <label for="canEditGroupInfo">ุชุนุฏูู ูุนูููุงุช ุงููุฌููุนุฉ</label>
                  <label class="toggle-switch"><input type="checkbox" id="canEditGroupInfo"><span class="slider round"></span></label>
              </div>
              <div class="settings-toggle-row">
                  <label for="canDeleteMessages">ุญุฐู ุงูุฑุณุงุฆู</label>
                  <label class="toggle-switch"><input type="checkbox" id="canDeleteMessages"><span class="slider round"></span></label>
              </div>
              <div class="settings-toggle-row">
                  <label for="canPinMessages">ุชุซุจูุช ุงูุฑุณุงุฆู</label>
                  <label class="toggle-switch"><input type="checkbox" id="canPinMessages"><span class="slider round"></span></label>
              </div>
              <div class="settings-toggle-row">
                  <label for="canBanUsers">ุญุธุฑ ุงููุณุชุฎุฏููู</label>
                  <label class="toggle-switch"><input type="checkbox" id="canBanUsers"><span class="slider round"></span></label>
              </div>
              <div class="settings-toggle-row" id="manageModsPermissionRow" style="display: none;">
                  <label for="canManageModerators">ุฅุฏุงุฑุฉ ุงููุดุฑููู</label>
                  <label class="toggle-switch"><input type="checkbox" id="canManageModerators"><span class="slider round"></span></label>
              </div>
          </div>
          <div class="dialog-footer">
              <button class="cancel-btn">ุฅูุบุงุก</button>
              <button id="savePermissionsBtn" class="confirm-btn">ุญูุธ ุงูุตูุงุญูุงุช</button>
          </div>
          <hr class="sidebar-divider" style="width:100%">
          <button id="banFromDialogBtn" class="sheet-btn sheet-btn-danger" style="width: 100%;">ุญุธุฑ ูุฐุง ุงููุณุชุฎุฏู</button>
      </div>
  </div>

  <div id="messageActionsSheet" class="profile-sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-content">
      <div class="sheet-button-group" style="max-width: 280px;">
        <button id="replyMessageBtn" class="sheet-btn"><i class="fas fa-reply"></i> ุฑุฏ</button>
        <button id="reactMessageBtn" class="sheet-btn"><i class="fas fa-smile"></i> ุฅุถุงูุฉ ุชูุงุนู</button>
        <hr class="sidebar-divider" style="width: 100%;" />
        <button id="pinMessageBtn" class="sheet-btn"><i class="fas fa-thumbtack"></i> ุชุซุจูุช ุงูุฑุณุงูุฉ</button>
        <button id="forwardMessageBtn" class="sheet-btn"><i class="fas fa-share"></i> ุฅุนุงุฏุฉ ุชูุฌูู</button>
        <button id="editMessageBtn" class="sheet-btn"><i class="fas fa-edit"></i> ุชุนุฏูู ุงูุฑุณุงูุฉ</button>
        <button id="deleteMessageBtn" class="sheet-btn sheet-btn-danger"><i class="fas fa-trash"></i> ุญุฐู ุงูุฑุณุงูุฉ</button>
        <button id="cancelActionBtn" class="sheet-btn" style="background-color: var(--border);">ุฅูุบุงุก</button>
      </div>
    </div>
  </div>

  <div id="editMessageDialog" class="dialog-box">
    <div class="dialog-content">
      <button class="dialog-close-btn">&times;</button>
      <h4>ุชุนุฏูู ุงูุฑุณุงูุฉ</h4>
      <textarea id="editMessageInput" class="dialog-textarea" rows="4" placeholder="ุงูุชุจ ุฑุณุงูุชู ุงููุนุฏูุฉ..."></textarea>
      <div class="dialog-footer">
        <button class="cancel-btn">ุฅูุบุงุก</button>
        <button id="saveEditBtn" class="confirm-btn">ุญูุธ</button>
      </div>
    </div>
  </div>

  <div id="confirmDialog" class="dialog-box">
    <div class="dialog-content">
      <h4 id="confirmDialogTitle" style="color: var(--danger);">ุชุฃููุฏ ุงูุฅุฌุฑุงุก</h4>
      <p id="confirmDialogMessage"></p>
      <div class="dialog-footer">
        <button id="confirmDialogNo" class="cancel-btn">ุฅูุบุงุก</button>
        <button id="confirmDialogYes" class="confirm-btn sheet-btn-danger">ุชุฃููุฏ</button>
      </div>
    </div>
  </div>

  <div id="forwardDialog" class="dialog-box">
    <div class="dialog-content list-dialog">
      <div class="dialog-header">
        <h4>ุฅุนุงุฏุฉ ุชูุฌูู ุฅูู...</h4>
        <button class="dialog-close-btn">&times;</button>
      </div>
      <div class="dialog-body">
        <ul id="forwardChatList"></ul>
      </div>
    </div>
  </div>

  <div id="reactionPicker" class="reaction-picker" style="display: none;">
      <span class="reaction-emoji">๐</span>
      <span class="reaction-emoji">โค๏ธ</span>
      <span class="reaction-emoji">๐</span>
      <span class="reaction-emoji">๐ฎ</span>
      <span class="reaction-emoji">๐ข</span>
      <span class="reaction-emoji">๐</span>
  </div>

  <div id="createPollDialog" class="dialog-box">
    <div class="dialog-content">
      <button class="dialog-close-btn">&times;</button>
      <h4>ุฅูุดุงุก ุงุณุชุทูุงุน ุฑุฃู</h4>
      <input type="text" id="pollQuestionInput" class="dialog-input" placeholder="ุงูุชุจ ุณุคุงู ุงูุงุณุชุทูุงุน...">
      <div id="pollOptionsContainer" class="dialog-body" style="gap: 8px;">
        <input type="text" class="dialog-input poll-option-input" placeholder="ุงูุฎูุงุฑ 1">
        <input type="text" class="dialog-input poll-option-input" placeholder="ุงูุฎูุงุฑ 2">
      </div>
      <button id="addPollOptionBtn" class="sidebar-btn">ุฅุถุงูุฉ ุฎูุงุฑ</button>
      <div class="dialog-footer">
        <button class="cancel-btn">ุฅูุบุงุก</button>
        <button id="submitCreatePollBtn" class="confirm-btn">ุฅูุดุงุก</button>
      </div>
    </div>
  </div>

</body>
</html>